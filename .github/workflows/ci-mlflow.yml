name: CI MLflow Training

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  train-model:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Set up job (checkout repository)
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 2. Set up Python 3.12.7
      - name: Set up Python 3.12.7
        uses: actions/setup-python@v5
        with:
          python-version: "3.12.7"
      
      # 3. Check Env (verify environment)
      - name: Check Env
        run: |
          python --version
          pip --version
      
      # 4. Install dependencies
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      # 5. Set MLflow Tracking URI
      - name: Set MLflow Tracking URI
        run: |
          echo "MLflow tracking URI will be set in the script"
      
      # 6. Run mlflow project
      - name: Run mlflow project
        run: |
          python modelling.py
      
      # 7. Install Python dependencies (if needed for post-processing)
      - name: Install Python dependencies
        run: |
          pip list
      
      # 8. Upload to Google Drive (optional - commented out)
      # - name: Upload to Google Drive
      #   uses: satackey/action-google-drive@v1
      #   with:
      #     credentials: ${{ secrets.GOOGLE_DRIVE_CREDENTIALS }}
      #     source: mlruns/
      #     destination: MLflow_Artifacts/
      
      # 9. Post Set up Python 3.12.7 (cleanup if needed)
      - name: Post Set up Python 3.12.7
        run: |
          echo "Python setup complete"
      
      # 10. Post Run actions/checkout@v3
      - name: Post Run actions/checkout@v4
        run: |
          echo "Checkout complete"
      
      # 11. Complete job
      - name: Complete job
        run: |
          echo "âœ… CI MLflow Training completed successfully"
          echo "Model artifacts saved in mlruns/"
