name: train-model

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  train-model:
    runs-on: ubuntu-latest

    steps:
    # 1Ô∏è‚É£ Set up job
    - name: Set up job
      run: echo "Start CI job"

    # 2Ô∏è‚É£ Checkout
    - name: Run actions/checkout@v3
      uses: actions/checkout@v3

    # 3Ô∏è‚É£ Set up Python (boleh tetap ADA)
    - name: Set up Python 3.12.7
      uses: actions/setup-python@v4
      with:
        python-version: "3.12.7"

    # 4Ô∏è‚É£ Check Env
    - name: Check Env
      run: python --version

    # 5Ô∏è‚É£ Install dependencies (HANYA mlflow)
    - name: Install dependencies
      run: pip install mlflow

    # 6Ô∏è‚É£ Set MLflow Tracking URI
    - name: Set MLflow Tracking URI
      run: echo "MLFLOW_TRACKING_URI=local (MLProject mode)"

    # 7Ô∏è‚É£ Run mlflow project (INI KUNCI)
    - name: Run mlflow project
      run: |
        mlflow run MLProject --env-manager=conda

    # 8Ô∏è‚É£ Install Python dependencies (POST STEP ‚Äì boleh kosong / echo)
    - name: Install Python dependencies
      run: echo "Handled by conda.yaml via MLflow Project"

    # 9Ô∏è‚É£ Upload artifact ‚Üí DIGANTI COMMIT KE GITHUB
    - name: Commit model artifact
      run: |
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git add .
        git commit -m "Add trained model artifact" || echo "No changes"
        git push

    # üîü Post steps
    - name: Post Run actions/checkout@v3
      run: echo "Post checkout"

    - name: Post Set up Python 3.12.7
      run: echo "Post python setup"

    # 1Ô∏è‚É£1Ô∏è‚É£ Complete job
    - name: Complete job
      run: echo "CI finished successfully"
